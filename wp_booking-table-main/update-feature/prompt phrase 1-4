ğŸ¯ TASK: Implement Timeline Feature - Phase 1-2 (Database & Backend)
Plugin: Restaurant Booking Manager
Version: 1.0.1

ğŸ“‹ REQUIREMENTS:

=== PHASE 1: DATABASE SCHEMA ENHANCEMENT ===

File: includes/class-database.php

1ï¸âƒ£ Add new method: migrate_to_timeline_schema()
   - Sáº½ Ä‘Æ°á»£c gá»i tá»« ensure_portal_schema()
   
2ï¸âƒ£ Add columns to wp_rb_bookings table:
   - checkin_time TIME NOT NULL (AFTER booking_time)
   - checkout_time TIME NOT NULL (AFTER checkin_time)
   - actual_checkin DATETIME NULL (AFTER checkout_time)
   - actual_checkout DATETIME NULL (AFTER actual_checkin)
   - cleanup_completed_at DATETIME NULL (AFTER actual_checkout)
   
3ï¸âƒ£ Add columns to wp_rb_tables table:
   - current_status ENUM('available','occupied','cleaning','reserved') DEFAULT 'available'
   - status_updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
   - last_booking_id INT NULL
   
4ï¸âƒ£ Add proper indexes:
   - wp_rb_bookings: KEY checkin_checkout_index (location_id, booking_date, checkin_time, checkout_time)
   - wp_rb_tables: KEY current_status_index (location_id, current_status)

5ï¸âƒ£ Safe migration for existing data:
   - Náº¿u checkin_time/checkout_time NULL â†’ set = booking_time
   - checkout_time = booking_time + 2 hours (tÃ­nh toÃ¡n tá»« booking_time)
   - DÃ¹ng $wpdb->get_var() Ä‘á»ƒ check column tá»“n táº¡i trÆ°á»›c khi add

---

=== PHASE 2: BACKEND LOGIC ENHANCEMENT ===

File: includes/class-booking.php

ğŸ”§ Add new methods:

1ï¸âƒ£ check_time_overlap($date, $checkin_time, $checkout_time, $location_id, $exclude_booking_id = null)
   Kiá»ƒm tra xem thá»i gian check-in/out cÃ³ overlap vá»›i booking khÃ¡c + cleanup buffer (1 hour)
   Return: boolean (true = cÃ³ overlap)
   
   Logic:
   - Láº¥y táº¥t cáº£ bookings á»Ÿ location_id, ngÃ y $date, status IN ('pending', 'confirmed')
   - Loáº¡i trá»« booking $exclude_booking_id náº¿u cÃ³
   - TÃ­nh: actual_checkin = checkin_time - 15 phÃºt (khÃ¡ch cÃ³ thá»ƒ sá»›m)
           actual_checkout = checkout_time + 15 phÃºt + 1 hour cleanup
   - So sÃ¡nh overlap vá»›i existing bookings
   - Náº¿u cÃ³ overlap â†’ return true

2ï¸âƒ£ is_time_slot_available($date, $time, $guest_count, $checkin_time, $checkout_time, $exclude_booking_id, $location_id)
   MODIFY existing method Ä‘á»ƒ handle timeline
   
   Validation Rules:
   - checkout_time > checkin_time (required)
   - Minimum duration: 1 hour
   - Maximum duration: 6 hours
   - KhÃ´ng overlap vá»›i bookings khÃ¡c + 1h cleanup buffer
   - Respect location working hours
   
   Logic:
   - Náº¿u $checkin_time/$checkout_time khÃ´ng truyá»n â†’ default = $time vÃ  $time + 2h
   - Kiá»ƒm tra: check_time_overlap()
   - Kiá»ƒm tra: available tables Ä‘á»§ capacity
   - Kiá»ƒm tra: location working hours
   Return: boolean

3ï¸âƒ£ get_timeline_data($date, $location_id)
   Return structured array cho calendar grid view
   
   Structure:
```php
   return array(
       'date' => '2024-01-15',
       'location_id' => 1,
       'time_slots' => array('09:00', '09:30', '10:00', ... '22:00'),
       'tables' => array(
           'table_1' => array(
               'id' => 1,
               'table_number' => 1,
               'capacity' => 4,
               'current_status' => 'available',
               'bookings' => array(
                   array(
                       'booking_id' => 123,
                       'customer_name' => 'John Doe',
                       'phone' => '0123456789',
                       'checkin_time' => '10:00',
                       'checkout_time' => '12:00',
                       'actual_checkin' => '09:45', // khÃ¡ch cÃ³ thá»ƒ sá»›m 15'
                       'actual_checkout' => '13:00', // 12:00 + 15' + 1h cleanup
                       'status' => 'confirmed',
                       'guest_count' => 4,
                       'booking_source' => 'website'
                   )
               )
           )
       )
   );
```
   
   Logic:
   - Generate time_slots tá»« location opening/closing time (interval 30 phÃºt)
   - Láº¥y táº¥t cáº£ tables á»Ÿ location
   - Láº¥y táº¥t cáº£ bookings á»Ÿ location, ngÃ y $date
   - Map bookings vÃ o tables tÆ°Æ¡ng á»©ng
   - TÃ­nh actual_checkin = checkin_time - 15'
   - TÃ­nh actual_checkout = checkout_time + 15' + 1h cleanup
   - Sort by checkin_time

4ï¸âƒ£ update_table_status($table_id, $status, $booking_id = null)
   Update wp_rb_tables.current_status
   Parameters:
   - $table_id (int)
   - $status (string): 'available', 'occupied', 'cleaning', 'reserved'
   - $booking_id (int): optional, Ä‘á»ƒ track booking nÃ o occupation
   
   Update fields:
   - current_status = $status
   - status_updated_at = NOW()
   - last_booking_id = $booking_id (náº¿u cÃ³)
   Return: boolean (success/fail)

5ï¸âƒ£ MODIFY create_booking() method:
   Add parameters:
   - $checkin_time (string, format: 'HH:MM')
   - $checkout_time (string, format: 'HH:MM')
   
   Validation:
   - Validate checkin < checkout
   - Validate duration 1-6 hours
   - Call is_time_slot_available() vá»›i checkin/checkout
   
   Store in booking:
   - booking_time = $checkin_time (hoáº·c keep as-is, depend on your logic)
   - checkin_time = $checkin_time
   - checkout_time = $checkout_time
   - actual_checkin = $checkin_time - 15 minutes
   - actual_checkout = $checkout_time + 15 minutes + 1 hour cleanup

6ï¸âƒ£ MODIFY confirm_booking() method:
   When booking confirmed â†’ update table status
   Logic:
   - Get table_number tá»« booking
   - Call update_table_status($table_id, 'reserved', $booking_id)

7ï¸âƒ£ Add new method: mark_checkin($booking_id, $actual_time = null)
   Update booking.actual_checkin = $actual_time (or NOW())
   Update table status = 'occupied'

8ï¸âƒ£ Add new method: mark_checkout($booking_id, $actual_time = null)
   Update booking.actual_checkout = $actual_time (or NOW())
   Update table status = 'cleaning'
   Set cleanup_completed_at = NOW() + 1 hour (tá»± Ä‘á»™ng)
   
   Sau 1h â†’ auto update status = 'available'

---

ğŸ§ª TEST CASES (Phase 1-2):

1. Database migration:
   âœ… Columns Ä‘Æ°á»£c add thÃ nh cÃ´ng
   âœ… Existing data Ä‘Æ°á»£c migrate (default values)
   âœ… Indexes Ä‘Æ°á»£c táº¡o
   
2. check_time_overlap():
   âœ… No overlap â†’ return false
   âœ… Overlap same slot â†’ return true
   âœ… Overlap with cleanup buffer â†’ return true
   âœ… Exclude booking_id works
   
3. is_time_slot_available():
   âœ… Valid slot â†’ return true
   âœ… Too short duration (<1h) â†’ return false
   âœ… Too long duration (>6h) â†’ return false
   âœ… Overlap existing booking â†’ return false
   âœ… Checkout < checkin â†’ return false
   
4. get_timeline_data():
   âœ… Return correct structure
   âœ… Time slots generated correctly
   âœ… All tables included
   âœ… Bookings mapped to correct tables
   âœ… actual_checkin/checkout calculated correctly (Â±15' + 1h cleanup)
   
5. update_table_status():
   âœ… Status updated
   âœ… status_updated_at updated
   âœ… last_booking_id saved
   
6. create_booking() with timeline:
   âœ… Accept checkin/checkout params
   âœ… Store values in DB
   âœ… Validate duration
   
7. confirm_booking():
   âœ… Table status changed to 'reserved'
   âœ… last_booking_id set

---

âš ï¸ CRITICAL POINTS:

âœ… Backward compatibility:
   - Existing bookings with NULL checkin/checkout â†’ auto-populate with defaults
   - Existing create_booking() calls â†’ still work (optional checkin/checkout)
   
âœ… Code standards:
   - Follow existing class structure
   - Use $wpdb->prepare() for security
   - Add inline comments (tiáº¿ng Viá»‡t)
   - Follow naming convention tá»« codebase
   
âœ… No breaking changes:
   - existing methods signature â†’ optional params only
   - existing data â†’ safe migration
   
âœ… Performance:
   - Indexes on frequently queried columns
   - Efficient queries (avoid N+1)
   - Use proper WHERE clauses

---

ğŸ“¦ DELIVERABLES (Phase 1-2):

1. Database schema updated vá»›i migration function
2. RB_Booking class with 8 new methods
3. All methods fully functional & tested
4. No breaking changes
5. Code matches existing style & standards
6. Ready for Phase 3-4 (AJAX integration)

---

ğŸš€ PRIORITY:

1. Database migration (must work)
2. check_time_overlap() (core logic)
3. is_time_slot_available() (core logic)
4. get_timeline_data() (data structure)
5. update_table_status() (status management)
6. Modify create_booking() + confirm_booking()
7. Mark checkin/checkout methods
8. Test all methods

---

ğŸ’¡ IMPLEMENTATION NOTES:

- Táº¥t cáº£ time calculations pháº£i xá»­ lÃ½ timezone Ä‘Ãºng
- DÃ¹ng 24-hour format (HH:MM)
- Cleanup time luÃ´n = 1 hour (fixed)
- actual_checkin = checkin_time - 15 minutes
- actual_checkout = checkout_time + 15 minutes + 1 hour cleanup
- Táº¥t cáº£ queries dÃ¹ng $wpdb->prepare()
```

---

## ğŸ“Œ PROMPT PHASE 3-4: AJAX + Admin UI
```
ğŸ¯ TASK: Implement Timeline Feature - Phase 3-4 (AJAX & Admin UI)
Plugin: Restaurant Booking Manager
Requires: Phase 1-2 completed & tested

ğŸ“‹ REQUIREMENTS:

=== PHASE 3: AJAX ENDPOINTS ===

File: includes/class-ajax.php

Add 3 new AJAX endpoints:

1ï¸âƒ£ wp_ajax_rb_get_timeline_data (hoáº·c wp_ajax_nopriv_rb_get_timeline_data cho frontend sau)
   
   Handler:
```php
   public function get_timeline_data() {
       // Verify nonce tá»« $_POST['nonce']
       // Get $date, $location_id tá»« $_POST
       // Call RB_Booking::get_timeline_data($date, $location_id)
       // Return wp_send_json_success($timeline_data)
   }
```
   
   Nonce: 'rb_admin_nonce' (reuse existing)
   Params: date (string YYYY-MM-DD), location_id (int)
   Response: JSON vá»›i timeline structure tá»« Phase 2

2ï¸âƒ£ wp_ajax_rb_update_table_status
   
   Handler:
```php
   public function update_table_status() {
       // Verify nonce
       // Get $table_id, $status, $booking_id tá»« $_POST
       // Validate $status IN ('available','occupied','cleaning','reserved')
       // Call RB_Booking::update_table_status()
       // Return success/error response
   }
```
   
   Nonce: 'rb_admin_nonce'
   Params: table_id (int), status (string), booking_id (int, optional)
   Response: { success: true, message: "..." }

3ï¸âƒ£ wp_ajax_rb_check_availability_extended (modify/add)
   
   Handler:
```php
   public function check_availability_extended() {
       // Verify nonce
       // Get date, checkin_time, checkout_time, guest_count, location_id tá»« $_POST
       // Call is_time_slot_available()
       // Return: available (true/false), message, available_tables_count
   }
```
   
   Nonce: 'rb_frontend_nonce' (hoáº·c rb_admin_nonce, reuse existing)
   Params: date, checkin_time, checkout_time, guest_count, location_id
   Response: { success: true, available: true/false, message: "...", available_count: 5 }

---

=== PHASE 4: ADMIN UI - TIMELINE VIEW ===

File: admin/class-admin.php

ğŸ”§ Add methods:

1ï¸âƒ£ add_admin_menu() - ADD submenu:
```php
   add_submenu_page(
       'restaurant-booking',
       'Timeline View',
       'ğŸ“Š Timeline',
       'manage_options',
       'rb-timeline',
       array($this, 'display_timeline_page')
   );
```

2ï¸âƒ£ NEW method: display_timeline_page()
   
   Render:
   - Page title: "ğŸ“Š Timeline View - Restaurant Booking"
   - Language switcher (top right)
   - Location selector dropdown
   - Date navigation (prev/next day + date picker)
   - Auto-refresh toggle (30 seconds)
   - Manual refresh button
   - Timeline grid container
   - Table status legend
   
   Initial Load:
   - Default location = first location tá»« DB
   - Default date = today
   - AJAX call: get_timeline_data()
   - Render timeline grid
   
   Grid Structure (HTML):
```html
   <div class="rb-timeline-container">
       <table class="rb-timeline-table">
           <thead>
               <tr>
                   <th class="rb-time-column">Giá»</th>
                   <th class="rb-table-column" data-table-id="1">BÃ n 1 (4 chá»—)</th>
                   <th class="rb-table-column" data-table-id="2">BÃ n 2 (4 chá»—)</th>
                   ...
               </tr>
           </thead>
           <tbody>
               <tr class="rb-time-row" data-time="09:00">
                   <td class="rb-time-cell">09:00</td>
                   <td class="rb-slot" data-table-id="1">
                       <!-- Booking cell or empty -->
                   </td>
                   <td class="rb-slot" data-table-id="2">
                       <!-- Booking cell or empty -->
                   </td>
               </tr>
               ...
           </tbody>
       </table>
   </div>
```
   
   Booking Cell Content:
```html
   <div class="rb-booking-cell" 
        data-booking-id="123" 
        data-table-id="1"
        style="height: Xpx; background: Ycolor;">
       <div class="rb-booking-header">
           <strong>John Doe</strong>
           <span class="rb-status-badge">confirmed</span>
       </div>
       <div class="rb-booking-info">
           10:00 - 12:00 (4 guests)
       </div>
       <div class="rb-booking-actions">
           <button class="rb-checkin-btn">Check-in</button>
           <button class="rb-checkout-btn">Check-out</button>
       </div>
   </div>
```

3ï¸âƒ£ Timeline Grid Rendering Logic:
   
   Calculate cell height:
   - Duration (hours) Ã— cell_height_per_hour (60px)
   - Min height: 30px (for visual)
   - Position: (checkin_time - start_time) Ã— 60px
   
   Color coding:
   - available: #4CAF50 (green)
   - occupied: #FF5722 (orange/red)
   - cleaning: #FFC107 (yellow)
   - reserved: #2196F3 (blue)
   - pending: #FFB74D (light orange)
   
   Status badges:
   - confirmed: green
   - pending: orange
   - cancelled: red
   - completed: grey

---

=== PHASE 4B: INLINE ACTIONS ===

Add methods for inline actions:

1ï¸âƒ£ Handle check-in click:
   - Show modal: "Check-in at HH:MM?"
   - Option: actual time (default now, or custom)
   - AJAX: mark_checkin($booking_id)
   - Update: table status â†’ 'occupied'
   - Refresh timeline

2ï¸âƒ£ Handle check-out click:
   - Show modal: "Check-out at HH:MM?"
   - AJAX: mark_checkout($booking_id)
   - Update: table status â†’ 'cleaning'
   - Show: "Table will be ready at HH:MM (1h cleanup)"
   - Refresh timeline

3ï¸âƒ£ Handle booking cell click:
   - Show popup: booking details
   - Options: Edit / Check-in / Check-out / Cancel / Delete
   - AJAX for each action
   - Refresh timeline

---

=== PHASE 4C: AUTO-REFRESH & CONTROLS ===

Add JavaScript functionality:

1ï¸âƒ£ Auto-refresh:
   - Checkbox: "Auto-refresh every 30 seconds"
   - When enabled: setInterval(function() { loadTimeline(); }, 30000)
   - When disabled: clearInterval()
   - Update last refreshed time

2ï¸âƒ£ Manual refresh:
   - Button: "ğŸ”„ Refresh"
   - AJAX: get_timeline_data()
   - Update timeline grid
   - Show: "Last updated: HH:MM:SS"

3ï¸âƒ£ Date navigation:
   - Prev button: date - 1 day
   - Next button: date + 1 day
   - Date picker: select specific date
   - Each change: reload timeline

4ï¸âƒ£ Location selector:
   - Dropdown: list all locations
   - Change: reload timeline for selected location

---

=== PHASE 4D: DRAG-AND-DROP (OPTIONAL but required) ===

Add drag-and-drop for table reassignment:

1ï¸âƒ£ Make booking cells draggable:
   - draggable="true"
   - On dragstart: store booking_id
   - Show: visual feedback (opacity, outline)

2ï¸âƒ£ Make table columns droppable:
   - ondrop: get target table_id
   - Validate: new table cÃ³ Ä‘á»§ capacity khÃ´ng?
   - AJAX: reassign booking to new table
   - Success: update cell position
   - Error: show alert

3ï¸âƒ£ Validation:
   - KhÃ¡ch khÃ´ng thá»ƒ drag vÃ o slot cÃ³ overlap
   - KhÃ¡ch khÃ´ng thá»ƒ drag vÃ o bÃ n quÃ¡ nhá»
   - Chá»‰ admin cÃ³ thá»ƒ drag

---

ğŸ“Œ STYLING & CSS

File: assets/css/timeline.css (new file)
```css
/* Timeline container */
.rb-timeline-container {
    overflow-x: auto;
    background: white;
    border: 1px solid #ccd0d4;
    border-radius: 3px;
    margin: 20px 0;
}

/* Timeline table */
.rb-timeline-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}

.rb-timeline-table th,
.rb-timeline-table td {
    border: 1px solid #eee;
    padding: 0;
    height: 60px; /* Per 30-min slot */
}

.rb-time-column {
    width: 60px;
    background: #f8f9fa;
    font-weight: 600;
    text-align: center;
    position: sticky;
    left: 0;
    z-index: 10;
}

.rb-table-column {
    background: #f0f6fc;
    font-weight: 600;
    text-align: center;
    min-width: 150px;
    position: relative;
}

/* Booking cell */
.rb-booking-cell {
    padding: 4px;
    border-radius: 3px;
    cursor: pointer;
    position: absolute;
    left: 1px;
    right: 1px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    transition: all 0.2s ease;
    draggable: true;
}

.rb-booking-cell:hover {
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transform: scale(1.02);
    z-index: 5;
}

.rb-booking-header {
    font-weight: 600;
    font-size: 11px;
    margin-bottom: 2px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.rb-status-badge {
    padding: 1px 4px;
    border-radius: 2px;
    font-size: 9px;
    background: rgba(255,255,255,0.3);
    color: white;
}

.rb-booking-info {
    font-size: 10px;
    margin-bottom: 3px;
    color: rgba(255,255,255,0.9);
}

.rb-booking-actions {
    display: flex;
    gap: 2px;
}

.rb-booking-actions button {
    flex: 1;
    padding: 2px 4px;
    font-size: 9px;
    background: rgba(255,255,255,0.2);
    color: white;
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.2s;
}

.rb-booking-actions button:hover {
    background: rgba(255,255,255,0.4);
}

/* Status colors */
.rb-status-available {
    background: #4CAF50 !important;
}

.rb-status-occupied {
    background: #FF5722 !important;
}

.rb-status-cleaning {
    background: #FFC107 !important;
    color: #333 !important;
}

.rb-status-reserved {
    background: #2196F3 !important;
}

.rb-status-pending {
    background: #FFB74D !important;
}

/* Responsive */
@media (max-width: 768px) {
    .rb-timeline-table th,
    .rb-timeline-table td {
        height: 80px;
    }
    
    .rb-booking-header {
        font-size: 10px;
    }
    
    .rb-booking-info {
        font-size: 9px;
    }
}
```

---

ğŸ“Œ JAVASCRIPT FILE

File: assets/js/timeline-view.js (new file)
```javascript
class RBTimelineView {
    constructor(config) {
        this.ajaxUrl = config.ajaxUrl;
        this.nonce = config.nonce;
        this.currentDate = config.date || new Date().toISOString().split('T')[0];
        this.locationId = config.locationId || 1;
        this.autoRefreshInterval = null;
        this.cellHeightPerHour = 60; // 60px per 30min = 120px per hour
        
        this.init();
    }
    
    init() {
        this.bindEvents();
        this.loadTimeline();
    }
    
    bindEvents() {
        // Date navigation
        jQuery('#rb-prev-day').on('click', () => this.changeDate(-1));
        jQuery('#rb-next-day').on('click', () => this.changeDate(1));
        jQuery('#rb-date-picker').on('change', (e) => {
            this.currentDate = e.target.value;
            this.loadTimeline();
        });
        
        // Location selector
        jQuery('#rb-timeline-location').on('change', (e) => {
            this.locationId = parseInt(e.target.value);
            this.loadTimeline();
        });
        
        // Auto-refresh
        jQuery('#rb-auto-refresh').on('change', (e) => {
            if (e.target.checked) {
                this.startAutoRefresh();
            } else {
                this.stopAutoRefresh();
            }
        });
        
        // Manual refresh
        jQuery('#rb-manual-refresh').on('click', () => this.loadTimeline());
        
        // Drag-and-drop
        jQuery(document).on('dragstart', '.rb-booking-cell', (e) => {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('bookingId', jQuery(e.target).closest('.rb-booking-cell').data('booking-id'));
        });
        
        jQuery(document).on('dragover', '.rb-slot', (e) => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            jQuery(e.currentTarget).addClass('rb-drag-over');
        });
        
        jQuery(document).on('dragleave', '.rb-slot', (e) => {
            jQuery(e.currentTarget).removeClass('rb-drag-over');
        });
        
        jQuery(document).on('drop', '.rb-slot', (e) => {
            e.preventDefault();
            jQuery(e.currentTarget).removeClass('rb-drag-over');
            
            const bookingId = e.dataTransfer.getData('bookingId');
            const newTableId = jQuery(e.currentTarget).data('table-id');
            this.reassignBooking(bookingId, newTableId);
        });
    }
    
    loadTimeline() {
        jQuery.ajax({
            url: this.ajaxUrl,
            type: 'POST',
            data: {
                action: 'rb_get_timeline_data',
                date: this.currentDate,
                location_id: this.locationId,
                nonce: this.nonce
            },
            success: (response) => {
                if (response.success) {
                    this.renderTimeline(response.data);
                    this.updateLastRefreshed();
                }
            }
        });
    }
    
    renderTimeline(data) {
        // Generate HTML grid
        // Calculate positions & heights
        // Render booking cells
        // Bind inline actions
    }
    
    changeDate(days) {
        const date = new Date(this.currentDate);
        date.setDate(date.getDate() + days);
        this.currentDate = date.toISOString().split('T')[0];
        this.loadTimeline();
    }
    
    startAutoRefresh() {
        this.autoRefreshInterval = setInterval(() => this.loadTimeline(), 30000);
    }
    
    stopAutoRefresh() {
        clearInterval(this.autoRefreshInterval);
    }
    
    reassignBooking(bookingId, newTableId) {
        // Validate & AJAX reassign
        // Update timeline
    }
    
    updateLastRefreshed() {
        const time = new Date().toLocaleTimeString();
        jQuery('#rb-last-refreshed').text(`Last updated: ${time}`);
    }
}

// Initialize on document ready
jQuery(document).ready(function() {
    new RBTimelineView({
        ajaxUrl: rbAjax.ajax_url,
        nonce: rbAjax.nonce,
        date: new Date().toISOString().split('T')[0],
        locationId: jQuery('#rb-timeline-location').val()
    });
});
```

---

ğŸ§ª TEST CASES (Phase 3-4):

1. AJAX endpoints:
   âœ… get_timeline_data returns correct structure
   âœ… update_table_status updates DB
   âœ… Nonce verification works
   âœ… Error handling for invalid params
   
2. Admin page:
   âœ… Page loads without errors
   âœ… Timeline grid renders correctly
   âœ… Location selector works
   âœ… Date navigation works
   âœ… Booking cells positioned correctly
   âœ… Colors match status
   
3. Interactive features:
   âœ… Check-in/out buttons work
   âœ… Auto-refresh on/off
   âœ… Manual refresh updates timeline
   âœ… Drag-and-drop works
   âœ… Modal popups display correctly
   
4. Responsive design:
   âœ… Mobile: scrollable grid
   âœ… Tablet: proper layout
   âœ… Desktop: full timeline
   
5. Performance:
   âœ… AJAX calls complete < 1s
   âœ… Auto-refresh doesn't block UI
   âœ… Timeline renders smoothly

---

âš ï¸ CRITICAL POINTS:

âœ… Security:
   - Nonce verification on all AJAX
   - current_user_can('manage_options')
   - Input sanitization
   
âœ… Performance:
   - Efficient DOM manipulation
   - Debounce drag-and-drop
   - Cache timeline data where possible
   
âœ… UX:
   - Loading indicators
   - Error messages clear
   - Keyboard shortcuts (optional)
   - Mobile-friendly

---

ğŸ“¦ DELIVERABLES (Phase 3-4):

1. 3 new AJAX endpoints fully functional
2. Admin timeline page with all controls
3. Timeline grid rendering correctly
4. Drag-and-drop working
5. Auto-refresh & manual refresh working
6. Custom styling (CSS + responsive)
7. JavaScript class well-structured
8. All features tested & working
9. No breaking changes
10. Ready for Phase 5 (Frontend + Translations)

---

ğŸš€ IMPLEMENTATION PRIORITY:

1. Add AJAX endpoints (Phase 3)
2. Create admin page structure (Phase 4)
3. Render timeline grid correctly
4. Add inline actions (check-in/out)
5. Add drag-and-drop
6. Add auto-refresh
7. Style & responsive design
8. Test all features
